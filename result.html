<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="result_style.css">
    <title>result</title>
</head>
<body>
    <div class="container">
        <h1>ğŸ„ë‹¹ì‹ ì„ ìœ„í•œ í¬ë¦¬ìŠ¤ë§ˆìŠ¤ ìºë¡¤ ğŸ„</h1>
        <div id="results">
            <h2 id="top1-title">ë¡œë”© ì¤‘...</h2>
            <iframe id="top1-iframe" width="100%" height="80" frameborder="0" allow="encrypted-media"></iframe>
            <h3 id="top2-title">ë¡œë”© ì¤‘...</h3>
            <h3 id="top3-title">ë¡œë”© ì¤‘...</h3>
        </div>
    </div>

    <script>
        // carols.json ë¶ˆëŸ¬ì˜¤ê¸°
        fetch('carols.json')
            .then(response => response.json())
            .then(carols => {
                // ì‚¬ìš©ì íƒœê·¸ í”„ë¡œí•„ ë¶ˆëŸ¬ì˜¤ê¸°
                const userprofile = JSON.parse(sessionStorage.getItem("userprofile")) || [];
                
                // ìì¹´ë“œ ìœ ì‚¬ë„ ê³„ì‚° í•¨ìˆ˜(êµì§‘í•©/í•©ì§‘í•©)
                function jaccardSimilarity(userprofile, carolsTags) {
                    // êµì§‘í•© ê°œìˆ˜
                    const intersection = userprofile.filter(tag => carolsTags.includes(tag)).length;
                    // í•©ì§‘í•© ê°œìˆ˜ A + B - êµì§‘í•©
                    const union = userprofile.length + carolsTags.length - intersection;
                    return intersection / union;
                }
                
                // ìºë¡¤ ìœ ì‚¬ë„ ê³„ì‚°
                const scoredCarols = carols.map(carol => {
                    const score = jaccardSimilarity(userprofile, carol.tags);
                    return { ...carol, score };
                });
                
                scoredCarols.sort((a, b) => b.score - a.score);
                const top3 = scoredCarols.slice(0, 3);
                
                // 'ë¡œë”© ì¤‘...' ì—†ì• ê¸°
                document.getElementById("results").innerHTML = "";
                
                // ìƒìœ„ 3ê°œ ìºë¡¤ ê²°ê³¼ í‘œì‹œ
                top3.forEach((song, index) => {
                    let cardhtml = "";
                    if(index == 0) {
                        cardhtml = `
                            <div class="song-card">
                                <h2>1ìœ„ ${song.title} - ${song.artist}</h2>
                                <iframe 
                                    data-testid="embed-iframe" 
                                    style="border-radius:12px" 
                                    src="https://open.spotify.com/embed/track/${song.spotifyId}?utm_source=generator&theme=0" 
                                    width="100%" 
                                    height="152" 
                                    frameBorder="0" 
                                    allowfullscreen="" 
                                    allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" 
                                    loading="lazy">
                                </iframe>
                            </div>
                        `;
                    } else {
                        cardhtml = `
                            <div class="song-card">
                                <h3>${index + 1}ìœ„ ${song.title} - ${song.artist}</h3>
                                <iframe 
                                    data-testid="embed-iframe" 
                                    style="border-radius:12px" 
                                    src="https://open.spotify.com/embed/track/${song.spotifyId}?utm_source=generator&theme=0" 
                                    width="100%" 
                                    height="152" 
                                    frameBorder="0" 
                                    allowfullscreen="" 
                                    allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" 
                                    loading="lazy">
                                </iframe> 
                            </div>
                        `;
                    }
                    
                    document.getElementById("results").innerHTML += cardhtml;
                });
                
                sessionStorage.removeItem("userprofile");
            })
    </script>
</body>
</html>